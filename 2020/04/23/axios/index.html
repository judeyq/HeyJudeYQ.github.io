<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>20ã€axiosçš„å°è£…</title><meta name="description" content="ğŸ¯ ğŸ¯ ğŸ¯ ğŸ¯ ğŸ¯"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
axios åŸºäº promise çš„ http åº“ ç‰¹æ€§ï¼šæ‹¦æˆªè¯·æ±‚å’Œå“åº”ã€å–æ¶ˆè¯·æ±‚ã€è½¬æ¢ jsonã€å®¢æˆ·ç«¯é˜²å¾¡ XSRF



å½“åç«¯æ¥å£æŠ¥äº† 500 é”™è¯¯æ—¶è¢« axios æ‹¦æˆªäº†ä½†ç¡®å¹¶æœªè¿”å›ä¸€ä¸ª promiseï¼Œå¯¼è‡´ä¸šåŠ¡ä»£ç ä¸­æœªæ•è·æ­¤é”™è¯¯ã€‚
æ‰€ä»¥è®°ä½ï¼š

åœ¨æ¯ä¸ª promise é“¾æ¡ä¸­å¿…é¡»è¿”å› promiseï¼Œå¦åˆ™è°ƒç”¨ç»“æœå¯èƒ½å’Œä½ é¢„æœŸä¸ä¸€æ ·ã€‚

service.interceptors.response.use(
  (response) =&amp;gt; &amp;#123;
    if (response.status === 200 &amp;amp;&amp;amp; response.data) &amp;#123;
      return response.data;
    &amp;#125; else &amp;#123;
     .."><meta name="generator" content="Hexo 5.4.1"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Jude's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">20ã€axiosçš„å°è£…</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81axios-%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">1ã€axios çš„å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%9C%A8-request-%E6%96%87%E4%BB%B6%E5%A4%B9-http-js"><span class="toc-text">2ã€åœ¨ request æ–‡ä»¶å¤¹ http.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%87%E6%8D%A2-%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6-post-%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%AE%BE%E7%BD%AE"><span class="toc-text">3ã€ç¯å¢ƒçš„åˆ‡æ¢&#x2F;è¯·æ±‚è¶…æ—¶&#x2F;post è¯·æ±‚å¤´è®¾ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA-%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA"><span class="toc-text">4ã€è¯·æ±‚æ‹¦æˆª å“åº”æ‹¦æˆª</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81get%E3%80%81post-%E8%AF%B7%E6%B1%82%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-text">5ã€getã€post è¯·æ±‚çš„å°è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81axios-%E5%AE%8C%E6%95%B4%E5%B0%81%E8%A3%85%E4%BB%A3%E7%A0%81"><span class="toc-text">6ã€axios å®Œæ•´å°è£…ä»£ç :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81token-%E5%A4%B1%E6%95%88%E5%8F%8A%E6%8E%A5%E5%8F%A3%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-text">7ã€token å¤±æ•ˆåŠæ¥å£å›½é™…åŒ–</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/axios"><i class="tag post-item-tag">axios</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">20ã€axiosçš„å°è£…</h1><time class="has-text-grey" datetime="2020-04-23T12:00:00.000Z">2020-04-23</time><article class="mt-2 post-content"><blockquote>
<p>axios åŸºäº promise çš„ http åº“ ç‰¹æ€§ï¼šæ‹¦æˆªè¯·æ±‚å’Œå“åº”ã€å–æ¶ˆè¯·æ±‚ã€è½¬æ¢ jsonã€å®¢æˆ·ç«¯é˜²å¾¡ XSRF</p>
</blockquote>
<span id="more"></span>

<p>å½“åç«¯æ¥å£æŠ¥äº† 500 é”™è¯¯æ—¶è¢« axios æ‹¦æˆªäº†ä½†ç¡®å¹¶æœªè¿”å›ä¸€ä¸ª promiseï¼Œå¯¼è‡´ä¸šåŠ¡ä»£ç ä¸­æœªæ•è·æ­¤é”™è¯¯ã€‚</p>
<p>æ‰€ä»¥è®°ä½ï¼š</p>
<blockquote>
<p>åœ¨æ¯ä¸ª promise é“¾æ¡ä¸­å¿…é¡»è¿”å› promiseï¼Œå¦åˆ™è°ƒç”¨ç»“æœå¯èƒ½å’Œä½ é¢„æœŸä¸ä¸€æ ·ã€‚</p>
</blockquote>
<pre><code class="js">service.interceptors.response.use(
  (response) =&gt; &#123;
    if (response.status === 200 &amp;&amp; response.data) &#123;
      return response.data;
    &#125; else &#123;
      return Promise.reject(new Error(&quot;è¯·æ±‚å¤±è´¥&quot;));
    &#125;
  &#125;,
  (error) =&gt; &#123;
    return Promise.reject(error);
  &#125;
);
</code></pre>
<h3 id="1ã€axios-çš„å®‰è£…"><a href="#1ã€axios-çš„å®‰è£…" class="headerlink" title="1ã€axios çš„å®‰è£…"></a>1ã€axios çš„å®‰è£…</h3><pre><code class="js">npm install axios
</code></pre>
<h3 id="2ã€åœ¨-request-æ–‡ä»¶å¤¹-http-js"><a href="#2ã€åœ¨-request-æ–‡ä»¶å¤¹-http-js" class="headerlink" title="2ã€åœ¨ request æ–‡ä»¶å¤¹ http.js"></a>2ã€åœ¨ request æ–‡ä»¶å¤¹ http.js</h3><pre><code class="js">// http.js
import axios from &quot;axios&quot;;
import QS from &quot;qs&quot;; // åºåˆ—åŒ–postç±»å‹çš„æ•°æ®
import &#123; Toast &#125; from &quot;vant&quot;; // å¼•å…¥vantç»„ä»¶åº“çš„toastç»„ä»¶
</code></pre>
<h3 id="3ã€ç¯å¢ƒçš„åˆ‡æ¢-è¯·æ±‚è¶…æ—¶-post-è¯·æ±‚å¤´è®¾ç½®"><a href="#3ã€ç¯å¢ƒçš„åˆ‡æ¢-è¯·æ±‚è¶…æ—¶-post-è¯·æ±‚å¤´è®¾ç½®" class="headerlink" title="3ã€ç¯å¢ƒçš„åˆ‡æ¢/è¯·æ±‚è¶…æ—¶/post è¯·æ±‚å¤´è®¾ç½®"></a>3ã€ç¯å¢ƒçš„åˆ‡æ¢/è¯·æ±‚è¶…æ—¶/post è¯·æ±‚å¤´è®¾ç½®</h3><pre><code class="js">// ç¯å¢ƒçš„åˆ‡æ¢
if (process.env.NODE_ENV == &quot;development&quot;) &#123;
  axios.defaults.baseURL = &quot;https://www.baidu.com&quot;;
&#125; else if (process.env.NODE_ENV == &quot;debug&quot;) &#123;
  axios.defaults.baseURL = &quot;https://www.ceshi.com&quot;;
&#125; else if (process.env.NODE_ENV == &quot;production&quot;) &#123;
  axios.defaults.baseURL = &quot;https://www.production.com&quot;;
&#125;

axios.defaults.timeout = 10000;

axios.defaults.headers.post[&quot;Content-Type&quot;] =
  &quot;application/x-www-form-urlencoded;charset=UTF-8&quot;;
</code></pre>
<h3 id="4ã€è¯·æ±‚æ‹¦æˆª-å“åº”æ‹¦æˆª"><a href="#4ã€è¯·æ±‚æ‹¦æˆª-å“åº”æ‹¦æˆª" class="headerlink" title="4ã€è¯·æ±‚æ‹¦æˆª å“åº”æ‹¦æˆª"></a>4ã€è¯·æ±‚æ‹¦æˆª å“åº”æ‹¦æˆª</h3><details>
<summary>ç‚¹å‡»å±•ç¤ºä»£ç </summary>

<pre><code class="js">// å…ˆå¯¼å…¥vuex,å› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨åˆ°é‡Œé¢çš„çŠ¶æ€å¯¹è±¡
// vuexçš„è·¯å¾„æ ¹æ®è‡ªå·±çš„è·¯å¾„å»å†™
import store from &#39;@/store/index&#39;;

// è¯·æ±‚æ‹¦æˆªå™¨
axios.interceptors.request.use(
    config =&gt; &#123;
        // æ¯æ¬¡å‘é€è¯·æ±‚ä¹‹å‰åˆ¤æ–­vuexä¸­æ˜¯å¦å­˜åœ¨token
        // å¦‚æœå­˜åœ¨ï¼Œåˆ™ç»Ÿä¸€åœ¨httpè¯·æ±‚çš„headeréƒ½åŠ ä¸Štokenï¼Œè¿™æ ·åå°æ ¹æ®tokenåˆ¤æ–­ä½ çš„ç™»å½•æƒ…å†µ
        // å³ä½¿æœ¬åœ°å­˜åœ¨tokenï¼Œä¹Ÿæœ‰å¯èƒ½tokenæ˜¯è¿‡æœŸçš„ï¼Œæ‰€ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­è¦å¯¹è¿”å›çŠ¶æ€è¿›è¡Œåˆ¤æ–­
        const token = store.state.token;
        token &amp;&amp; (config.headers.Authorization = token);
        return config;
    &#125;,
    error =&gt; &#123;
        return Promise.error(error);
    &#125;
)

// å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(
    response =&gt; &#123;
        // å¦‚æœè¿”å›çš„çŠ¶æ€ç ä¸º200ï¼Œè¯´æ˜æ¥å£è¯·æ±‚æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸æ‹¿åˆ°æ•°æ®
        // å¦åˆ™çš„è¯æŠ›å‡ºé”™è¯¯
        if (response.status === 200) &#123;
            return Promise.resolve(response);
        &#125; else &#123;
            return Promise.reject(response);
        &#125;
    &#125;,
    // æœåŠ¡å™¨çŠ¶æ€ç ä¸æ˜¯2å¼€å¤´çš„çš„æƒ…å†µ
    // è¿™é‡Œå¯ä»¥è·Ÿä½ ä»¬çš„åå°å¼€å‘äººå‘˜åå•†å¥½ç»Ÿä¸€çš„é”™è¯¯çŠ¶æ€ç 
    // ç„¶åæ ¹æ®è¿”å›çš„çŠ¶æ€ç è¿›è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ç™»å½•è¿‡æœŸæç¤ºï¼Œé”™è¯¯æç¤ºç­‰ç­‰
    // ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„æ“ä½œï¼Œå…¶ä»–éœ€æ±‚å¯è‡ªè¡Œæ‰©å±•
    error =&gt; &#123;
        if (error.response.status) &#123;
            switch (error.response.status) &#123;
                // 401: æœªç™»å½•
                // æœªç™»å½•åˆ™è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶æºå¸¦å½“å‰é¡µé¢çš„è·¯å¾„
                // åœ¨ç™»å½•æˆåŠŸåè¿”å›å½“å‰é¡µé¢ï¼Œè¿™ä¸€æ­¥éœ€è¦åœ¨ç™»å½•é¡µæ“ä½œã€‚
                case 401:
                    router.replace(&#123;
                        path: &#39;/login&#39;,
                        query: &#123;
                            redirect: router.currentRoute.fullPath
                        &#125;
                    &#125;);
                    break;
                // 403 tokenè¿‡æœŸ
                // ç™»å½•è¿‡æœŸå¯¹ç”¨æˆ·è¿›è¡Œæç¤º
                // æ¸…é™¤æœ¬åœ°tokenå’Œæ¸…ç©ºvuexä¸­tokenå¯¹è±¡
                // è·³è½¬ç™»å½•é¡µé¢
                case 403:
                     Toast(&#123;
                        message: &#39;ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•&#39;,
                        duration: 1000,
                        forbidClick: true
                    &#125;);
                    // æ¸…é™¤token
                    localStorage.removeItem(&#39;token&#39;);
                    store.commit(&#39;loginSuccess&#39;, null);
                    // è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶å°†è¦æµè§ˆçš„é¡µé¢fullPathä¼ è¿‡å»ï¼Œç™»å½•æˆåŠŸåè·³è½¬éœ€è¦è®¿é—®çš„é¡µé¢
                    setTimeout(() =&gt; &#123;
                        router.replace(&#123;
                            path: &#39;/login&#39;,
                            query: &#123;
                                redirect: router.currentRoute.fullPath
                            &#125;
                        &#125;);
                    &#125;, 1000);
                    break;

                // 404è¯·æ±‚ä¸å­˜åœ¨
                case 404:
                    Toast(&#123;
                        message: &#39;ç½‘ç»œè¯·æ±‚ä¸å­˜åœ¨&#39;,
                        duration: 1500,
                        forbidClick: true
                    &#125;);
                    break;
                // å…¶ä»–é”™è¯¯ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯æç¤º
                default:
                    Toast(&#123;
                        message: error.response.data.message,
                        duration: 1500,
                        forbidClick: true
                    &#125;);
            &#125;
            return Promise.reject(error.response);
        &#125;
    &#125;
&#125;);
</code></pre>
</details>

<h3 id="5ã€getã€post-è¯·æ±‚çš„å°è£…"><a href="#5ã€getã€post-è¯·æ±‚çš„å°è£…" class="headerlink" title="5ã€getã€post è¯·æ±‚çš„å°è£…"></a>5ã€getã€post è¯·æ±‚çš„å°è£…</h3><blockquote>
<p>get æ–¹æ³•ï¼šæˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ª get å‡½æ•°ï¼Œget å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæˆ‘ä»¬è¦è¯·æ±‚çš„ url åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦æºå¸¦çš„è¯·æ±‚å‚æ•°ã€‚get å‡½æ•°è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œå½“ axios å…¶è¯·æ±‚æˆåŠŸæ—¶ resolve æœåŠ¡å™¨è¿”å› å€¼ï¼Œè¯·æ±‚å¤±è´¥æ—¶ reject é”™è¯¯å€¼ã€‚æœ€åé€šè¿‡ export æŠ›å‡º get å‡½æ•°ã€‚</p>
</blockquote>
<details>
<summary>ç‚¹å‡»å±•ç¤ºä»£ç </summary>

<pre><code class="js">/**
 * getæ–¹æ³•ï¼Œå¯¹åº”getè¯·æ±‚
 * @param &#123;String&#125; url [è¯·æ±‚çš„urlåœ°å€]
 * @param &#123;Object&#125; params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°]
 */
export function get(url, params) &#123;
  return new Promise((resolve, reject) =&gt; &#123;
    axios
      .get(url, &#123;
        params: params,
      &#125;)
      .then((res) =&gt; &#123;
        resolve(res.data);
      &#125;)
      .catch((err) =&gt; &#123;
        reject(err.data);
      &#125;);
  &#125;);
&#125;
</code></pre>
</details>

<blockquote>
<p>åŸç†åŒ get åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œpost æ–¹æ³•å¿…é¡»è¦ä½¿ç”¨å¯¹æäº¤ä»å‚æ•°å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€šè¿‡ node çš„ qs æ¨¡å—æ¥åºåˆ—åŒ–æˆ‘ä»¬çš„å‚æ•°ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œå¦‚æœæ²¡æœ‰åºåˆ—åŒ–æ“ä½œï¼Œåå°æ˜¯æ‹¿ä¸åˆ°ä½ æäº¤çš„æ•°æ®çš„ã€‚è¿™å°±æ˜¯æ–‡ç« å¼€å¤´æˆ‘ä»¬ import QS from â€˜qsâ€™;çš„åŸå› </p>
</blockquote>
<details>
<summary>ç‚¹å‡»å±•ç¤ºä»£ç </summary>

<pre><code class="js">/**
 * postæ–¹æ³•ï¼Œå¯¹åº”postè¯·æ±‚
 * @param &#123;String&#125; url [è¯·æ±‚çš„urlåœ°å€]
 * @param &#123;Object&#125; params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°]
 */
export function post(url, params) &#123;
  return new Promise((resolve, reject) =&gt; &#123;
    axios
      .post(url, QS.stringify(params))
      .then((res) =&gt; &#123;
        resolve(res.data);
      &#125;)
      .catch((err) =&gt; &#123;
        reject(err.data);
      &#125;);
  &#125;);
&#125;
</code></pre>
</details>

<h3 id="6ã€axios-å®Œæ•´å°è£…ä»£ç "><a href="#6ã€axios-å®Œæ•´å°è£…ä»£ç " class="headerlink" title="6ã€axios å®Œæ•´å°è£…ä»£ç :"></a>6ã€axios å®Œæ•´å°è£…ä»£ç :</h3><details>
<summary>ç‚¹å‡»å±•ç¤ºä»£ç </summary>

<pre><code class="js">/**
 * axioså°è£…
 * è¯·æ±‚æ‹¦æˆªã€å“åº”æ‹¦æˆªã€é”™è¯¯ç»Ÿä¸€å¤„ç†
 */
import axios from &quot;axios&quot;;
import router from &quot;../router&quot;;
import store from &quot;../store/index&quot;;
import &#123; Toast &#125; from &quot;vant&quot;;

/**
 * æç¤ºå‡½æ•°
 * ç¦æ­¢ç‚¹å‡»è’™å±‚ã€æ˜¾ç¤ºä¸€ç§’åå…³é—­
 */
const tip = (msg) =&gt; &#123;
  Toast(&#123;
    message: msg,
    duration: 1000,
    forbidClick: true,
  &#125;);
&#125;;

/**
 * è·³è½¬ç™»å½•é¡µ
 * æºå¸¦å½“å‰é¡µé¢è·¯ç”±ï¼Œä»¥æœŸåœ¨ç™»å½•é¡µé¢å®Œæˆç™»å½•åè¿”å›å½“å‰é¡µé¢
 */
const toLogin = () =&gt; &#123;
  router.replace(&#123;
    path: &quot;/login&quot;,
    query: &#123;
      redirect: router.currentRoute.fullPath,
    &#125;,
  &#125;);
&#125;;

/**
 * è¯·æ±‚å¤±è´¥åçš„é”™è¯¯ç»Ÿä¸€å¤„ç†
 * @param &#123;Number&#125; status è¯·æ±‚å¤±è´¥çš„çŠ¶æ€ç 
 */
const errorHandle = (status, other) =&gt; &#123;
  // çŠ¶æ€ç åˆ¤æ–­
  switch (status) &#123;
    // 401: æœªç™»å½•çŠ¶æ€ï¼Œè·³è½¬ç™»å½•é¡µ
    case 401:
      toLogin();
      break;
    // 403 tokenè¿‡æœŸ
    // æ¸…é™¤tokenå¹¶è·³è½¬ç™»å½•é¡µ
    case 403:
      tip(&quot;ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•&quot;);
      localStorage.removeItem(&quot;token&quot;);
      store.commit(&quot;loginSuccess&quot;, null);
      setTimeout(() =&gt; &#123;
        toLogin();
      &#125;, 1000);
      break;
    // 404è¯·æ±‚ä¸å­˜åœ¨
    case 404:
      tip(&quot;è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨&quot;);
      break;
    default:
      console.log(other);
  &#125;
&#125;;

// åˆ›å»ºaxioså®ä¾‹
var instance = axios.create(&#123; timeout: 1000 * 12 &#125;);
// è®¾ç½®postè¯·æ±‚å¤´
instance.defaults.headers.post[&quot;Content-Type&quot;] =
  &quot;application/x-www-form-urlencoded&quot;;
/**
 * è¯·æ±‚æ‹¦æˆªå™¨
 * æ¯æ¬¡è¯·æ±‚å‰ï¼Œå¦‚æœå­˜åœ¨tokenåˆ™åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦token
 */
instance.interceptors.request.use(
  (config) =&gt; &#123;
    // ç™»å½•æµç¨‹æ§åˆ¶ä¸­ï¼Œæ ¹æ®æœ¬åœ°æ˜¯å¦å­˜åœ¨tokenåˆ¤æ–­ç”¨æˆ·çš„ç™»å½•æƒ…å†µ
    // ä½†æ˜¯å³ä½¿tokenå­˜åœ¨ï¼Œä¹Ÿæœ‰å¯èƒ½tokenæ˜¯è¿‡æœŸçš„ï¼Œæ‰€ä»¥åœ¨æ¯æ¬¡çš„è¯·æ±‚å¤´ä¸­æºå¸¦token
    // åå°æ ¹æ®æºå¸¦çš„tokenåˆ¤æ–­ç”¨æˆ·çš„ç™»å½•æƒ…å†µï¼Œå¹¶è¿”å›ç»™æˆ‘ä»¬å¯¹åº”çš„çŠ¶æ€ç 
    // è€Œåæˆ‘ä»¬å¯ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­ï¼Œæ ¹æ®çŠ¶æ€ç è¿›è¡Œä¸€äº›ç»Ÿä¸€çš„æ“ä½œã€‚
    const token = store.state.token;
    token &amp;&amp; (config.headers.Authorization = token);
    return config;
  &#125;,
  (error) =&gt; Promise.error(error)
);

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
  // è¯·æ±‚æˆåŠŸ
  (res) =&gt; (res.status === 200 ? Promise.resolve(res) : Promise.reject(res)),
  // è¯·æ±‚å¤±è´¥
  (error) =&gt; &#123;
    const &#123; response &#125; = error;
    if (response) &#123;
      // è¯·æ±‚å·²å‘å‡ºï¼Œä½†æ˜¯ä¸åœ¨2xxçš„èŒƒå›´
      errorHandle(response.status, response.data.message);
      return Promise.reject(response);
    &#125; else &#123;
      // å¤„ç†æ–­ç½‘çš„æƒ…å†µ
      // eg:è¯·æ±‚è¶…æ—¶æˆ–æ–­ç½‘æ—¶ï¼Œæ›´æ–°stateçš„networkçŠ¶æ€
      // networkçŠ¶æ€åœ¨app.vueä¸­æ§åˆ¶ç€ä¸€ä¸ªå…¨å±€çš„æ–­ç½‘æç¤ºç»„ä»¶çš„æ˜¾ç¤ºéšè—
      // å…³äºæ–­ç½‘ç»„ä»¶ä¸­çš„åˆ·æ–°é‡æ–°è·å–æ•°æ®ï¼Œä¼šåœ¨æ–­ç½‘ç»„ä»¶ä¸­è¯´æ˜
      if (!window.navigator.onLine) &#123;
        store.commit(&quot;changeNetwork&quot;, false);
      &#125; else &#123;
        return Promise.reject(error);
      &#125;
    &#125;
  &#125;
);

export default instance;
</code></pre>
</details>

<h3 id="7ã€token-å¤±æ•ˆåŠæ¥å£å›½é™…åŒ–"><a href="#7ã€token-å¤±æ•ˆåŠæ¥å£å›½é™…åŒ–" class="headerlink" title="7ã€token å¤±æ•ˆåŠæ¥å£å›½é™…åŒ–"></a>7ã€token å¤±æ•ˆåŠæ¥å£å›½é™…åŒ–</h3><details>
<summary>ç‚¹å‡»å±•ç¤ºä»£ç </summary>

<pre><code class="js">/**
 * æ˜¯å¦è¶…æ—¶
 */
export function isCheckTimeout() &#123;
  // å½“å‰æ—¶é—´æˆ³
  var currentTime = Date.now();
  // ç¼“å­˜æ—¶é—´æˆ³
  var timeStamp = getTimeStamp();
  return currentTime - timeStamp &gt; TOKEN_TIMEOUT_VALUE;
&#125;

import axios from &quot;axios&quot;;
import store from &quot;@/store&quot;;
import &#123; ElMessage &#125; from &quot;element-plus&quot;;
import &#123; isCheckTimeout &#125; from &quot;@/utils/auth&quot;;

const service = axios.create(&#123;
  baseURL: process.env.VUE_APP_BASE_API,
  timeout: 5000,
&#125;);

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  (config) =&gt; &#123;
    // åœ¨è¿™ä¸ªä½ç½®éœ€è¦ç»Ÿä¸€çš„å»æ³¨å…¥token
    if (store.getters.token) &#123;
      if (isCheckTimeout()) &#123;
        // ç™»å‡ºæ“ä½œ
        store.dispatch(&quot;user/logout&quot;);
        return Promise.reject(new Error(&quot;token å¤±æ•ˆ&quot;));
      &#125;
      // å¦‚æœtokenå­˜åœ¨ æ³¨å…¥token
      config.headers.Authorization = `Bearer $&#123;store.getters.token&#125;`;
    &#125;
    // é…ç½®æ¥å£å›½é™…åŒ–
    config.headers[&quot;Accept-Language&quot;] = store.getters.language;
    return config; // å¿…é¡»è¿”å›é…ç½®
  &#125;,
  (error) =&gt; &#123;
    return Promise.reject(error);
  &#125;
);

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response) =&gt; &#123;
    const &#123; success, message, data &#125; = response.data;
    //   è¦æ ¹æ®successçš„æˆåŠŸä¸å¦å†³å®šä¸‹é¢çš„æ“ä½œ
    if (success) &#123;
      return data;
    &#125; else &#123;
      // ä¸šåŠ¡é”™è¯¯
      ElMessage.error(message); // æç¤ºé”™è¯¯æ¶ˆæ¯
      return Promise.reject(new Error(message));
    &#125;
  &#125;,
  (error) =&gt; &#123;
    // å¤„ç† token è¶…æ—¶é—®é¢˜
    if (
      error.response &amp;&amp;
      error.response.data &amp;&amp;
      error.response.data.code === 401
    ) &#123;
      // tokenè¶…æ—¶
      store.dispatch(&quot;user/logout&quot;);
    &#125;
    ElMessage.error(error.message); // æç¤ºé”™è¯¯ä¿¡æ¯
    return Promise.reject(error);
  &#125;
);

export default service;
</code></pre>
</details>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2020/04/28/v-charts/" title="21ã€v-chartsçš„options"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: 21ã€v-chartsçš„options</span></a><a class="button is-default" href="/2020/04/20/echarts/" title="19ã€å…³äºechartså®˜æ–¹çš„ä¸€ä¸ªbug -- sublinkè·³è½¬é—®é¢˜"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: 19ã€å…³äºechartså®˜æ–¹çš„ä¸€ä¸ªbug -- sublinkè·³è½¬é—®é¢˜</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Jude"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> Jude 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>