<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>82ã€egg-mysqlçš„å¢åˆ æ”¹æŸ¥</title><meta name="description" content="ğŸ¯ ğŸ¯ ğŸ¯ ğŸ¯ ğŸ¯"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="MySQLå®‰è£…æˆåŠŸåï¼Œåœ¨eggé¡¹ç›®ä¸­å®‰è£…egg-mysqlæ’ä»¶ï¼Œé…ç½®å®Œæˆåï¼Œç¼–å†™æŸ¥è¯¢ã€æ–°å¢ã€åˆ é™¤ã€ç¼–è¾‘æ¥å£ã€‚


ä¸€ã€å®‰è£…MySQLç‰ˆæœ¬é€‰æ‹©MySQL 8.0.20  Mac Intel ç‰ˆæœ¬
å®‰è£…è¿‡ç¨‹è®¾ç½®å¯†ç ï¼š0987654321
æ­¤æ—¶åœ¨terminalè¾“å…¥å‘½ä»¤ï¼š
mysql -u root -p

Commod not found
1ã€terminaè¿›å…¥ è·¯å¾„ï¼š/usr/local/mysql/bin  æŸ¥çœ‹ç›®å½•æ˜¯å¦æœ‰mysql
å¦‚æœå­˜åœ¨ï¼Œåœ¨æ­¤è·¯å¾„ä¸‹æ‰§è¡Œï¼švim ~/.bash_profile
æ‰“å¼€åï¼Œè¾“å…¥ i é”®ï¼Œè¿›å…¥ç¼–è¾‘ï¼Œåœ¨.bash_profileä¸­æ·»åŠ mysql/binçš„ç›®å½•ï¼Œå®Œæˆåï¼ŒESCé€€å‡ºç¼–è¾‘ï¼Œè¾“å…¥ï¼šwqå›è½¦ä¿å­˜
PATH=$PATH:/usr/local/mysql/bin

2ã€è¾“å…¥s.."><meta name="generator" content="Hexo 5.4.1"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Jude's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">82ã€egg-mysqlçš„å¢åˆ æ”¹æŸ¥</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85MySQL"><span class="toc-text">ä¸€ã€å®‰è£…MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81egg-js%E5%AE%89%E8%A3%85egg-mysql%E6%8F%92%E4%BB%B6"><span class="toc-text">äºŒã€egg.jså®‰è£…egg-mysqlæ’ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85egg-mysql%E5%8F%8A%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">1ã€å®‰è£…egg-mysqlåŠæ’ä»¶é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9-service-home-js"><span class="toc-text">2ã€ä¿®æ”¹ service&#x2F;home.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9controller-home-js%E4%B8%AD%E7%9A%84user%E6%96%B9%E6%B3%95"><span class="toc-text">3ã€ä¿®æ”¹controller&#x2F;home.jsä¸­çš„useræ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-text">4ã€è·¯ç”±é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%96%B0%E5%A2%9E%E6%8E%A5%E5%8F%A3"><span class="toc-text">ä¸‰ã€æ–°å¢æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%BC%96%E8%BE%91%E6%8E%A5%E5%8F%A3"><span class="toc-text">å››ã€ç¼–è¾‘æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3"><span class="toc-text">äº”ã€åˆ é™¤æ¥å£</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/egg"><i class="tag post-item-tag">egg</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">82ã€egg-mysqlçš„å¢åˆ æ”¹æŸ¥</h1><time class="has-text-grey" datetime="2022-08-03T12:00:00.000Z">2022-08-03</time><article class="mt-2 post-content"><p>MySQLå®‰è£…æˆåŠŸåï¼Œåœ¨eggé¡¹ç›®ä¸­å®‰è£…egg-mysqlæ’ä»¶ï¼Œé…ç½®å®Œæˆåï¼Œç¼–å†™æŸ¥è¯¢ã€æ–°å¢ã€åˆ é™¤ã€ç¼–è¾‘æ¥å£ã€‚</p>
<span id="more"></span>

<h2 id="ä¸€ã€å®‰è£…MySQL"><a href="#ä¸€ã€å®‰è£…MySQL" class="headerlink" title="ä¸€ã€å®‰è£…MySQL"></a>ä¸€ã€å®‰è£…MySQL</h2><p>ç‰ˆæœ¬é€‰æ‹©MySQL 8.0.20  Mac Intel ç‰ˆæœ¬</p>
<p>å®‰è£…è¿‡ç¨‹è®¾ç½®å¯†ç ï¼š0987654321</p>
<p>æ­¤æ—¶åœ¨terminalè¾“å…¥å‘½ä»¤ï¼š</p>
<pre><code>mysql -u root -p
</code></pre>
<p>Commod not found</p>
<p>1ã€terminaè¿›å…¥ è·¯å¾„ï¼š/usr/local/mysql/bin  æŸ¥çœ‹ç›®å½•æ˜¯å¦æœ‰mysql</p>
<p>å¦‚æœå­˜åœ¨ï¼Œåœ¨æ­¤è·¯å¾„ä¸‹æ‰§è¡Œï¼švim ~/.bash_profile</p>
<p>æ‰“å¼€åï¼Œè¾“å…¥ i é”®ï¼Œè¿›å…¥ç¼–è¾‘ï¼Œåœ¨.bash_profileä¸­æ·»åŠ mysql/binçš„ç›®å½•ï¼Œå®Œæˆåï¼ŒESCé€€å‡ºç¼–è¾‘ï¼Œè¾“å…¥ï¼šwqå›è½¦ä¿å­˜</p>
<pre><code>PATH=$PATH:/usr/local/mysql/bin
</code></pre>
<p>2ã€è¾“å…¥source  ~/.bash_profile      ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<p>3ã€æŒ‡ä»¤ç™»å½•æ•°æ®åº“ï¼šmysql -u root -p   è¾“å…¥å¯†ç ï¼š0987654321</p>
<p>4ã€å¼€å¯æœåŠ¡ï¼šmysql.server start</p>
<h2 id="äºŒã€egg-jså®‰è£…egg-mysqlæ’ä»¶"><a href="#äºŒã€egg-jså®‰è£…egg-mysqlæ’ä»¶" class="headerlink" title="äºŒã€egg.jså®‰è£…egg-mysqlæ’ä»¶"></a>äºŒã€egg.jså®‰è£…egg-mysqlæ’ä»¶</h2><h4 id="1ã€å®‰è£…egg-mysqlåŠæ’ä»¶é…ç½®"><a href="#1ã€å®‰è£…egg-mysqlåŠæ’ä»¶é…ç½®" class="headerlink" title="1ã€å®‰è£…egg-mysqlåŠæ’ä»¶é…ç½®"></a>1ã€å®‰è£…egg-mysqlåŠæ’ä»¶é…ç½®</h4><pre><code class="shell">npm install egg-mysql

</code></pre>
<p>config/plugin.js</p>
<pre><code class="js">&#39;use strict&#39;;

/** @type Egg.EggPlugin */
module.exports = &#123;
  ejs: &#123;
    enable: true,
    package: &#39;egg-view-ejs&#39;
  &#125;,
  mysql: &#123;
    enable: true,
    package: &#39;egg-mysql&#39;
  &#125;
&#125;;
</code></pre>
<p>config/plugin-default.js</p>
<pre><code class="js">exports.mysql = &#123;
  // å•æ•°æ®åº“ä¿¡æ¯é…ç½®
  client: &#123;
    // host
    host: &#39;localhost&#39;,
    // ç«¯å£å·
    port: &#39;3306&#39;,
    // ç”¨æˆ·å
    user: &#39;root&#39;,
    // å¯†ç 
    password: &#39;æ•°æ®åº“å¯†ç &#39;, // åˆå§‹åŒ–å¯†ç ï¼Œæ²¡è®¾ç½®çš„å¯ä»¥ä¸å†™
    // æ•°æ®åº“å
    database: &#39;test&#39;, // æˆ‘ä»¬æ–°å»ºçš„æ•°æ®åº“åç§°
  &#125;,
  // æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯
  app: true,
  // æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­
  agent: false,
&#125;;
</code></pre>
<h4 id="2ã€ä¿®æ”¹-service-home-js"><a href="#2ã€ä¿®æ”¹-service-home-js" class="headerlink" title="2ã€ä¿®æ”¹ service/home.js"></a>2ã€ä¿®æ”¹ <code>service/home.js</code></h4><pre><code class="js">&#39;use strict&#39;;

const Service = require(&#39;egg&#39;).Service;

class HomeService extends Service &#123;
  async user() &#123;
    const &#123; ctx, app &#125; = this;
    const QUERY_STR = &#39;id, name&#39;;
    let sql = `select $&#123;QUERY_STR&#125; from list`; // è·å– id çš„ sql è¯­å¥
    try &#123;
      const result = await app.mysql.query(sql); // mysql å®ä¾‹å·²ç»æŒ‚è½½åˆ° app å¯¹è±¡ä¸‹ï¼Œå¯ä»¥é€šè¿‡ app.mysql è·å–åˆ°ã€‚
      return result;
    &#125; catch (error) &#123;
      console.log(error);
      return null;
    &#125;
  &#125;
&#125;
module.exports = HomeService;
</code></pre>
<h4 id="3ã€ä¿®æ”¹controller-home-jsä¸­çš„useræ–¹æ³•"><a href="#3ã€ä¿®æ”¹controller-home-jsä¸­çš„useræ–¹æ³•" class="headerlink" title="3ã€ä¿®æ”¹controller/home.jsä¸­çš„useræ–¹æ³•"></a>3ã€ä¿®æ”¹controller/home.jsä¸­çš„useræ–¹æ³•</h4><pre><code class="js">async user() &#123;
  const &#123; ctx &#125; = this;
  const result = await ctx.service.home.user();
  ctx.body = result
&#125;
</code></pre>
<h4 id="4ã€è·¯ç”±é…ç½®"><a href="#4ã€è·¯ç”±é…ç½®" class="headerlink" title="4ã€è·¯ç”±é…ç½®"></a>4ã€è·¯ç”±é…ç½®</h4><pre><code class="js">router.get(&#39;/user&#39;, controller.home.user);
</code></pre>
<h2 id="ä¸‰ã€æ–°å¢æ¥å£"><a href="#ä¸‰ã€æ–°å¢æ¥å£" class="headerlink" title="ä¸‰ã€æ–°å¢æ¥å£"></a>ä¸‰ã€æ–°å¢æ¥å£</h2><p>åœ¨ <code>service/home.js</code> ä¸‹æ–°å»ºä¸€ä¸ªå‡½æ•° <code>addUser</code></p>
<pre><code class="js">// æ–°å¢
async addUser(name) &#123;
  const &#123; ctx, app &#125; = this;
  try &#123;
    const result = await app.mysql.insert(&#39;list&#39;, &#123; name &#125;); // ç»™ list è¡¨ï¼Œæ–°å¢ä¸€æ¡æ•°æ®
    return result;
  &#125; catch (error) &#123;
    console.log(error);
    return null;
  &#125;
&#125;
</code></pre>
<p>å†ä¸º <code>controller/home.js</code> æ·»åŠ ä¸€ä¸ª <code>addUser</code> æ–¹æ³•</p>
<pre><code class="js">async addUser() &#123;
  const &#123; ctx &#125; = this;
  const &#123; name &#125; = ctx.request.body;
  try &#123;
    const result = await ctx.service.home.addUser(name);
    ctx.body = &#123;
      code: 200,
      msg: &#39;æ·»åŠ æˆåŠŸ&#39;,
      data: null
    &#125;
  &#125; catch (error) &#123;
    ctx.body = &#123;
      code: 500,
      msg: &#39;æ·»åŠ å¤±è´¥&#39;,
      data: null
    &#125;
  &#125;
&#125;
</code></pre>
<p>é…ç½®è·¯ç”±</p>
<pre><code class="js">router.post(&#39;/add_user&#39;, controller.home.addUser);
</code></pre>
<p>è¿™ä¸ªpostè¯·æ±‚éœ€è¦ä½¿ç”¨postmanæµ‹è¯•æ¥å£æ˜¯å¦æˆåŠŸã€‚</p>
<h2 id="å››ã€ç¼–è¾‘æ¥å£"><a href="#å››ã€ç¼–è¾‘æ¥å£" class="headerlink" title="å››ã€ç¼–è¾‘æ¥å£"></a>å››ã€ç¼–è¾‘æ¥å£</h2><p>é€šè¿‡ <code>/user</code> æ‹¿åˆ°äº†åˆ—è¡¨æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>id</code> å®šä½æŸæ¡æ•°æ®ï¼Œå»ä¿®æ”¹å®ƒçš„ <code>name</code> å±æ€§ã€‚</p>
<p><code>/service/home.js</code>ï¼Œæ·»åŠ ç¼–è¾‘æ“ä½œ</p>
<pre><code class="js">// ç¼–è¾‘
async editUser(id, name) &#123;
  const &#123; ctx, app &#125; = this;
  try &#123;
    let result = await app.mysql.update(&#39;list&#39;, &#123; name &#125;, &#123;
      where: &#123;
        id
      &#125;
    &#125;);
    return result;
  &#125; catch (error) &#123;
    console.log(error);
    return null;
  &#125;
&#125;
</code></pre>
<p><code>/controller/home.js</code> æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="js">// ç¼–è¾‘
async editUser() &#123;
  const &#123; ctx &#125; = this;
  const &#123; id, name &#125; = ctx.request.body;
  try &#123;
    const result = await ctx.service.home.editUser(id, name);
    ctx.body = &#123;
      code: 200,
      msg: &#39;æ·»åŠ æˆåŠŸ&#39;,
      data: null
    &#125;
  &#125; catch (error) &#123;
    ctx.body = &#123;
      code: 500,
      msg: &#39;æ·»åŠ å¤±è´¥&#39;,
      data: null
    &#125;
  &#125;
&#125;
</code></pre>
<p>é…ç½®è·¯ç”±ï¼š</p>
<pre><code class="js">router.post(&#39;/edit_user&#39;, controller.home.editUser);
</code></pre>
<p>postè¯·æ±‚éœ€è¦ä½¿ç”¨postmanå·¥å…·æµ‹è¯•æ¥å£</p>
<h2 id="äº”ã€åˆ é™¤æ¥å£"><a href="#äº”ã€åˆ é™¤æ¥å£" class="headerlink" title="äº”ã€åˆ é™¤æ¥å£"></a>äº”ã€åˆ é™¤æ¥å£</h2><p>åœ¨ <code>/service/home.js</code> æ·»åŠ åˆ é™¤æ¥å£</p>
<pre><code class="js">// åˆ é™¤
async deleteUser(id) &#123;
  const &#123; ctx, app &#125; = this;
  try &#123;
    let result = await app.mysql.delete(&#39;list&#39;, &#123; id &#125;);
    return result;
  &#125; catch (error) &#123;
    console.log(error);
    return null;
  &#125;
&#125;
</code></pre>
<p><code>/controller/home.js</code> æ·»åŠ ç›¸åº”çš„æ§åˆ¶å™¨æ–¹æ³•</p>
<pre><code class="js">// åˆ é™¤
async deleteUser() &#123;
  const &#123; ctx &#125; = this;
  const &#123; id &#125; = ctx.request.body;
  try &#123;
    const result = await ctx.service.home.deleteUser(id);
    ctx.body = &#123;
      code: 200,
      msg: &#39;åˆ é™¤æˆåŠŸ&#39;,
      data: null
    &#125;
  &#125; catch (error) &#123;
    ctx.body = &#123;
      code: 500,
      msg: &#39;åˆ é™¤å¤±è´¥&#39;,
      data: null
    &#125;
  &#125;
&#125;
</code></pre>
<p>æ·»åŠ ç›¸åº”è·¯ç”±ï¼š</p>
<pre><code class="js">// router.js
router.post(&#39;/delete_user&#39;, controller.home.deleteUser);
</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2022/08/02/81-egg.js/" title="81ã€egg.js(äºŒ)"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: 81ã€egg.js(äºŒ)</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Jude"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> Jude 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>